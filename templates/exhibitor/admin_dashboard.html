{% extends "summit/base.html" %}
{% load static %}

{% block content %}
<div class="container-fluid mt-4 px-4">
  <h2 class="fw-bold text-primary mb-4">Exhibitions Dashboard</h2>

  <!-- Top Action Buttons -->
  <div class="d-flex justify-content-between mb-4">
    <div>
      <a href="{% url 'add_section' %}" class="btn btn-primary me-2">
        <i class="fas fa-plus-circle me-1"></i> Add Section
      </a>
      <a href="{% url 'add_booth' %}" class="btn btn-success">
        <i class="fas fa-plus-square me-1"></i> Add Booth
      </a>
    </div>
  </div>

  <!-- Exhibition Sections -->
  <div class="card shadow-sm border-0 rounded-4 mb-4">
    <div class="card-header bg-primary text-white fw-semibold">
      <i class="fas fa-layer-group me-2"></i>Exhibition Sections
    </div>
    <div class="card-body p-0">
      <table class="table table-hover align-middle mb-0">
        <thead class="table-light">
          <tr>
            <th>Name</th>
            <th>Description</th>
            <th class="text-center">Action</th>
          </tr>
        </thead>
        <tbody>
          {% for section in sections %}
          <tr>
            <td class="fw-semibold">{{ section.name }}</td>
            <td>{{ section.description|default:"—" }}</td>
            <td class="text-center">
              <form method="post" action="{% url 'admin_delete_section' section.id %}"
                    onsubmit="return confirm('Are you sure you want to delete this section?');"
                    class="d-inline">
                {% csrf_token %}
                <button type="submit" class="btn btn-sm btn-outline-danger">
                  <i class="fas fa-trash"></i> Delete
                </button>
              </form>
            </td>
          </tr>
          {% empty %}
          <tr>
            <td colspan="3" class="text-center text-muted py-3">No sections yet.</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>

  <!-- Booths Table -->
  <div class="card shadow-sm border-0 rounded-4 mb-4">
    <div class="card-header bg-success text-white fw-semibold">
      <i class="fas fa-store me-2"></i>Booths
    </div>
    <div class="card-body p-0">
      <table class="table table-hover align-middle mb-0">
        <thead class="table-light">
          <tr>
            <th>Booth No.</th>
            <th>Type</th>
            <th>Size</th>
            <th>Price (KES)</th>
            <th>Section</th>
            <th>Status</th>
            <th class="text-center">Action</th>
          </tr>
        </thead>
        <tbody>
          {% for b in booths %}
          <tr>
            <td>{{ b.booth_number }}</td>
            <td>{{ b.get_booth_type_display }}</td>
            <td>{{ b.size }}</td>
            <td>{{ b.price|floatformat:2 }}</td>
            <td>{{ b.section.name }}</td>
            <td>
              {% if b.is_booked %}
                <span class="badge bg-danger">Booked</span>
              {% else %}
                <span class="badge bg-success">Available</span>
              {% endif %}
            </td>
            <td class="text-center">
              <a href="{% url 'admin_edit_booth' b.id %}" class="btn btn-sm btn-outline-primary me-1">
                <i class="fas fa-edit"></i>
              </a>
              <a href="{% url 'delete_booth' b.id %}" class="btn btn-sm btn-outline-danger">
                <i class="fas fa-trash"></i>
              </a>
            </td>
          </tr>
          {% empty %}
          <tr>
            <td colspan="7" class="text-center text-muted py-3">No booths available.</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>

  <!-- Summary Cards -->
  <div class="row g-3 mb-4">
    <div class="col-md-3">
      <div class="card text-center shadow-sm border-0 rounded-4 py-3">
        <h6 class="text-muted mb-1">Total Exhibitors</h6>
        <h3 class="fw-bold text-primary">{{ total_exhibitors }}</h3>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card text-center shadow-sm border-0 rounded-4 py-3">
        <h6 class="text-muted mb-1">Total Booths</h6>
        <h3 class="fw-bold text-success">{{ total_booths }}</h3>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card text-center shadow-sm border-0 rounded-4 py-3">
        <h6 class="text-muted mb-1">Booked Booths</h6>
        <h3 class="fw-bold text-danger">{{ booked_booths }}</h3>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card text-center shadow-sm border-0 rounded-4 py-3">
        <h6 class="text-muted mb-1">Pending Approvals</h6>
        <h3 class="fw-bold text-warning">{{ pending_approvals }}</h3>
      </div>
    </div>
  </div>

  <!-- Filters -->
  <div class="card shadow-sm border-0 rounded-4 mb-4">
    <div class="card-header bg-light fw-semibold">
      <i class="fas fa-filter me-2 text-primary"></i>Filters
    </div>
    <div class="card-body">
      <form method="GET" class="row g-3 align-items-center">
        <div class="col-md-3">
          <input
            type="text"
            name="q"
            class="form-control"
            placeholder="Search by name, email, phone, or organization..."
            value="{{ query }}"
          />
        </div>

        <div class="col-md-2">
          <select name="category" class="form-select">
            <option value="">Filter by Category</option>
            {% for value, label in categories %}
              <option value="{{ value }}" {% if category_filter == value %}selected{% endif %}>{{ label }}</option>
            {% endfor %}
          </select>
        </div>

        <div class="col-md-2">
          <select name="section" class="form-select">
            <option value="">Filter by Section</option>
            {% for s in sections %}
              <option value="{{ s.id }}" {% if section_filter|add:'' == s.id|add:'' %}selected{% endif %}>{{ s.name }}</option>
            {% endfor %}
          </select>
        </div>

        <div class="col-md-2">
            <select name="country_of_registration" class="form-select">
              <option value="">Filter by Country</option>
              {% for code, name in available_countries %}
                <option value="{{ code }}" {% if country_filter == code %}selected{% endif %}>
                  {{ name }}
                </option>
              {% endfor %}
            </select>
        </div>

        <div class="col-md-1 d-grid">
          <button type="submit" class="btn btn-primary">
            <i class="fas fa-filter me-1"></i> Apply
          </button>
        </div>

        <div class="col-md-2 d-grid">
          <a href="{% url 'admin_dashboard' %}" class="btn btn-outline-secondary">
            <i class="fas fa-undo me-1"></i> Reset
          </a>
        </div>
      </form>
    </div>
  </div>

  <!-- Recent Exhibitors -->
  <div class="card shadow-sm border-0 rounded-4 mb-5">
    <div class="card-header bg-primary text-white fw-semibold">
      <i class="fas fa-users me-2"></i>Recent Exhibitors
    </div>
    <div class="card-body p-0">
      <table class="table table-hover align-middle mb-0">
        <thead class="table-light">
          <tr>
            <th>Name</th>
            <th>Email</th>
            <th>Phone</th>
            <th>Organization</th>
            <th>Country</th>
            <th>Job Title</th>
            <th>Category</th>
            <th>Booth</th>
            <th>Section</th>
            <th>Date Registered</th>
            <th class="text-center">Action</th>
          </tr>
        </thead>
        <tbody>
          {% for e in exhibitors %}
          <tr>
            <td>{{ e.get_full_name }}</td>
            <td>{{ e.email }}</td>
            <td>{{ e.phone }}</td>
            <td>{{ e.organization_type }}</td>
              <td>{{ e.get_country_of_registration_display|default:"—" }}</td>
            <td>{{ e.job_title|default:"—" }}</td>
            <td>{{ e.get_category_display|default:"—" }}</td>
            <td>{{ e.booth.booth_number|default:"—" }}</td>
            <td>{{ e.section.name|default:"—" }}</td>
            <td>{{ e.created_at|date:"M d, Y H:i" }}</td>
            <td class="text-center">
              <a href="{% url 'admin_exhibitor_delete' e.id %}" class="btn btn-sm btn-outline-danger">
                <i class="fas fa-trash"></i>
              </a>
            </td>
          </tr>
          {% empty %}
          <tr>
            <td colspan="11" class="text-center text-muted py-3">No exhibitors registered.</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>
{% endblock %}
