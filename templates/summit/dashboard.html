import { useEffect, useState } from "react";
import { Pie, Bar, Line } from "react-chartjs-2";

export default function Dashboard() {
  const [stats, setStats] = useState(null);

  useEffect(() => {
    fetch("/api/dashboard/stats/")
      .then(res => res.json())
      .then(data => setStats(data));
  }, []);

  if (!stats) return <p>Loading...</p>;

  return (
    <div className="p-4">
      <h2>Total Registrants: {stats.total}</h2>

      <Pie
        data={{
          labels: stats.categories.map(c => c.category),
          datasets: [{ data: stats.categories.map(c => c.count) }]
        }}
      />

      <Bar
        data={{
          labels: Object.keys(stats.interests),
          datasets: [{ data: Object.values(stats.interests) }]
        }}
      />

      <Line
        data={{
          labels: stats.registrations_over_time.map(r => r.date),
          datasets: [{ data: stats.registrations_over_time.map(r => r.count) }]
        }}
      />

      <p>Updates Opt-in: {stats.updates_percent.toFixed(1)}%</p>
    </div>
  );
}
