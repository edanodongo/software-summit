{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Summit Registrants - Print</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body {
      background: #fff;
      padding: 40px;
      font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
    }
    .no-print { 
        margin-bottom: 15px; 
    }
    .cover-page { 
        text-align: center; 
        margin-top: 80px; 
    }
    .cover-page img { 
        max-height: 120px; 
        margin-bottom: 20px; 
    }
    .cover-page h1 { 
        font-weight: bold; 
        font-size: 2.2rem; 
    }
    .cover-page p { 
        margin: 5px 0; 
        font-size: 16px; 
        color: #555; 
    }
    .summary { 
        margin-top: 50px; 
        text-align: left; 
    }
    .summary h4 { 
        margin-bottom: 15px; 
    }
    .charts-row { 
        display: flex; 
        flex-wrap: wrap; 
        justify-content: center; 
        gap: 30px; margin-top: 30px; 
    }
    .chart-box { 
        flex: 1 1 300px; 
        max-width: 400px; 
    }
    .page-break { 
        page-break-before: always; 
    }
    @media print {
      .no-print { 
        display: none !important; }
      table { 
        font-size: 12px; }
    }
    
  </style>
</head>
<body>
  <div class="container">

    <!-- Cover Page -->
    <div class="cover-page">
      <img src="{% static 'images/event-logo.png' %}" alt="Event Logo">
      <h1>Kenya Software Summit</h1>
      <p><strong>Official Registrant Report</strong></p>
      <p><small>Generated on {{ now|date:"M d, Y H:i" }}</small></p>

      <!-- Summary Stats -->
      <div class="summary">
        <h4>Summary Statistics</h4>
        <ul class="list-group">
          <li class="list-group-item d-flex justify-content-between">
            <span>Total Registrants:</span>
            <strong>{{ registrants.count }}</strong>
          </li>
        </ul>


        <!-- Category Breakdown -->
        <h5 class="mt-3">By Category</h5>
        <ul class="list-group">
          {% regroup registrants by category as category_list %}
          {% for c in category_list %}
            <li class="list-group-item d-flex justify-content-between">
              <span>{{ c.grouper }}:</span>
              <strong>{{ c.list|length }}</strong>
            </li>
          {% empty %}
            <li class="list-group-item">No category data available</li>
          {% endfor %}
        </ul>

        
        <!-- Organization Breakdown -->
        <h5 class="mt-3">Top Organizations</h5>
        <ul class="list-group">
          {% regroup registrants by organization as org_list %}
          {% for o in org_list|slice:":5" %}
            <li class="list-group-item d-flex justify-content-between">
              <span>{{ o.grouper|default:"Independent" }}:</span>
              <strong>{{ o.list|length }}</strong>
            </li>
          {% empty %}
            <li class="list-group-item">No organization data available</li>
          {% endfor %}
        </ul>
      </div>

      <!-- Charts -->
      <div class="charts-row">
        <div class="chart-box">
          <h6>Category Distribution</h6>
          <canvas id="categoryChart"></canvas>
        </div>
      </div>
    </div>

    <!-- Page Break -->
    <div class="page-break"></div>

    <!-- Print Button (only visible on screen)
    {% if not pdf_mode %}
        <button onclick="window.print()" class="btn btn-sm btn-primary">
            <i class="fas fa-print"></i> Print
        </button>
        </div>
    {% endif %}
     -->
    
    <div class="d-flex justify-content-end no-print mb-3">
      <button onclick="window.print()" class="btn btn-sm btn-primary">
        <i class="fas fa-print"></i> Print
      </button>
    </div>


    <!-- Registrant Table -->
    <h4 class="mb-3">Registrant List</h4>
    <table class="table table-bordered table-sm">
      <thead class="table-light">
        <tr>
          <th>#</th>
          <th>Full Name</th>
          <th>Email</th>
          <th>Phone</th>
          <th>Organization</th>
          <th>Job Title</th>
          <th>Category</th>
          <th>Interests</th>
          <th>Registered On</th>
        </tr>
      </thead>
      <tbody>
        {% for reg in registrants %}
        <tr>
          <td>{{ forloop.counter }}</td>
          <td>{{ reg.full_name }}</td>
          <td>{{ reg.email }}</td>
          <td>{{ reg.phone }}</td>
          <td>{{ reg.organization|default:"—" }}</td>
          <td>{{ reg.job_title|default:"—" }}</td>
          <td>{{ reg.get_category_display }}</td>
          <td>{% if reg.interests %}{{ reg.interests|join:", " }}{% else %}—{% endif %}</td>
          <td>{{ reg.created_at|date:"M d, Y H:i" }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    // Data passed from Django template
    const categoryCounts = {{ category_counts|safe }};

    // Category Chart
    new Chart(document.getElementById("categoryChart"), {
      type: "doughnut",
      data: {
        labels: categoryCounts.map(c => c.category),
        datasets: [{
          data: categoryCounts.map(c => c.count),
          backgroundColor: ["#36a2eb","#ff6384","#ffcd56","#4bc0c0","#9966ff","#ff9f40"]
        }]
      }
    });

    // Category Chart
    new Chart(document.getElementById("categoryChart"), {
      type: "doughnut",
      data: {
        labels: categoryCounts.map(c => c.category),
        datasets: [{
          data: categoryCounts.map(c => c.count),
          backgroundColor: ["#36a2eb","#ff6384","#ffcd56","#4bc0c0","#9966ff","#ff9f40"]
        }]
      }
    });
  </script>

  <script src="https://kit.fontawesome.com/a2e0e9f6d4.js" crossorigin="anonymous"></script>
</body>
</html>
